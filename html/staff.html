<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Staff | All</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="container-fluid">
            <h3>Welcome
                <span id="staff_name"></span>
            </h3>
            <div class="row p-2">
                <h3 class="col-8">Service Requests</h3>
            </div>
            <table class="table table-bordered">
                <tr>
                    <th>Service Request ID</th>
                    <th>Service Request Type</th>
                    <th>Service Request Status</th>
                </tr>
                <tbody id="svc-body"></tbody>
            </table>
        </div>
        <script>
            if (localStorage.getItem("staffid") == null) {
                window.location.href = "/login_staff.html";
            }
            async function getData() {
                const res1 = await fetch(`http://localhost:8000/staff/${
                    localStorage.getItem("staffid")
                }`);
                const data = await res1.json();
                console.log(data);
                document.getElementById("staff_name").innerHTML = data.firstname + " " + data.lastname;
                const res = await fetch('http://localhost:8000/service_requests_by_staff/' + localStorage.getItem("staffid") + '/')
                const resJson = await res.json()
                var svc_body = document.getElementById("svc-body");
                for (var i = 0; i < resJson.service_requests.length; i++) {
                    var row = svc_body.insertRow();
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    cell1.innerHTML = dataSvc.service_requests[i] ?. ticketid;
                    cell2.innerHTML = dataSvc.service_requests[i] ?. description;
                    cell3.innerHTML = dataSvc.service_requests[i] ?. ticketstatus;
                }
            }
            getData()
        </script>
    </body>
</html>
